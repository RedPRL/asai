<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>S (asai.Asai.StructuredReporter.S)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../../index.html">asai</a> &#x00BB; <a href="../../index.html">Asai</a> &#x00BB; <a href="../index.html">StructuredReporter</a> &#x00BB; S</nav><header class="odoc-preamble"><h1>Module type <code><span>StructuredReporter.S</span></code></h1></header><nav class="odoc-toc"><ul><li><a href="#sending-messages">Sending Messages</a></li><li><a href="#backtraces">Backtraces</a></li><li><a href="#locations">Locations</a></li><li><a href="#constructing-diagnostics">Constructing Diagnostics</a></li><li><a href="#algebraic-effects">Algebraic Effects</a></li><li><a href="#debugging">Debugging</a></li></ul></nav><div class="odoc-content"><div class="odoc-spec"><div class="spec module anchored" id="module-Message"><a href="#module-Message" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Message/index.html">Message</a></span><span> : <a href="../module-type-Message/index.html">Message</a></span></code></div></div><h3 id="sending-messages"><a href="#sending-messages" class="anchor"></a>Sending Messages</h3><div class="odoc-spec"><div class="spec value anchored" id="val-emit"><a href="#val-emit" class="anchor"></a><code><span><span class="keyword">val</span> emit : 
  <span><span class="optlabel">?severity</span>:<a href="../../Diagnostic/index.html#type-severity">Diagnostic.severity</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?loc</span>:<a href="../../Range/index.html#type-t">Range.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?text</span>:<a href="../../Diagnostic/index.html#type-text">Diagnostic.text</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?backtrace</span>:<a href="../../Diagnostic/index.html#type-backtrace">Diagnostic.backtrace</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?extra_remarks</span>:<span><a href="../../Diagnostic/index.html#type-loctext">Diagnostic.loctext</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="Message/index.html#type-t">Message.t</a> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div><div class="spec-doc"><p><code>emit message</code> emits the <code>message</code> and continues the computation.</p><p>Example:</p><pre class="language-ocaml"><code>Reporter.emit @@ TypeError (tm, ty)</code></pre><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">severity</span> <p>The severity (to overwrite the default severity inferred from the <code>message</code>).</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">loc</span> <p>The location of the text (usually the code) to highlight. The default value is the innermost location given by <a href="#val-trace"><code>trace</code></a>, <a href="#val-with_loc"><code>with_loc</code></a>, <a href="#val-merge_loc"><code>merge_loc</code></a>, or <a href="#val-run"><code>run</code></a>.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">text</span> <p>The text (to overwrite the default text inferred from the message <code>msg</code>).</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">backtrace</span> <p>The backtrace (to overwrite the accumulative frames up to this point).</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">extra_remarks</span> <p>Additional remarks that are not part of the backtrace.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-emit_diagnostic"><a href="#val-emit_diagnostic" class="anchor"></a><code><span><span class="keyword">val</span> emit_diagnostic : <span><span><a href="Message/index.html#type-t">Message.t</a> <a href="../../Diagnostic/index.html#type-t">Diagnostic.t</a></span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Emit a diagnostic and continue the computation.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-fatal"><a href="#val-fatal" class="anchor"></a><code><span><span class="keyword">val</span> fatal : 
  <span><span class="optlabel">?severity</span>:<a href="../../Diagnostic/index.html#type-severity">Diagnostic.severity</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?loc</span>:<a href="../../Range/index.html#type-t">Range.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?text</span>:<a href="../../Diagnostic/index.html#type-text">Diagnostic.text</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?backtrace</span>:<a href="../../Diagnostic/index.html#type-backtrace">Diagnostic.backtrace</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?extra_remarks</span>:<span><a href="../../Diagnostic/index.html#type-loctext">Diagnostic.loctext</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="Message/index.html#type-t">Message.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p><code>fatal message</code> aborts the current computation with the <code>message</code>.</p><p>Example:</p><pre class="language-ocaml"><code>Reporter.fatal @@ CatError &quot;forgot to feed the cat&quot;</code></pre><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">severity</span> <p>The severity (to overwrite the default severity inferred from the <code>message</code>).</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">loc</span> <p>The location of the text (usually the code) to highlight. The default value is the innermost location given by <a href="#val-trace"><code>trace</code></a>, <a href="#val-with_loc"><code>with_loc</code></a>, <a href="#val-merge_loc"><code>merge_loc</code></a>, or <a href="#val-run"><code>run</code></a>.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">text</span> <p>The text (to overwrite the default text inferred from the <code>message</code>).</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">backtrace</span> <p>The backtrace (to overwrite the accumulative frames up to this point).</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">extra_remarks</span> <p>Additional remarks that are not part of the backtrace.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-fatal_diagnostic"><a href="#val-fatal_diagnostic" class="anchor"></a><code><span><span class="keyword">val</span> fatal_diagnostic : <span><span><a href="Message/index.html#type-t">Message.t</a> <a href="../../Diagnostic/index.html#type-t">Diagnostic.t</a></span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p>Abort the computation with a diagnostic.</p></div></div><h3 id="backtraces"><a href="#backtraces" class="anchor"></a>Backtraces</h3><div class="odoc-spec"><div class="spec value anchored" id="val-get_backtrace"><a href="#val-get_backtrace" class="anchor"></a><code><span><span class="keyword">val</span> get_backtrace : <span>unit <span class="arrow">&#45;&gt;</span></span> <a href="../../Diagnostic/index.html#type-backtrace">Diagnostic.backtrace</a></span></code></div><div class="spec-doc"><p><code>get_backtrace()</code> returns the current backtrace.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-with_backtrace"><a href="#val-with_backtrace" class="anchor"></a><code><span><span class="keyword">val</span> with_backtrace : <span><a href="../../Diagnostic/index.html#type-backtrace">Diagnostic.backtrace</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span>unit <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p><code>with_backtrace bt f</code> runs the thunk <code>f</code> with <code>bt</code> as the initial backtrace.</p><p>Example:</p><pre class="language-ocaml"><code>(* running code with a fresh backtrace *)
with_backtrace Emp @@ fun () -&gt; ...</code></pre></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-trace"><a href="#val-trace" class="anchor"></a><code><span><span class="keyword">val</span> trace : <span><span class="optlabel">?loc</span>:<a href="../../Range/index.html#type-t">Range.t</a> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> <span><span>(<span>unit <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p><code>trace str f</code> records the string <code>str</code> and runs the thunk <code>f</code> with the new backtrace.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">loc</span> <p>The location of the text (usually the code) to highlight. Note that a location given here will become the new default location for inner <a href="#val-emit"><code>emit</code></a> and <a href="#val-fatal"><code>fatal</code></a>.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-tracef"><a href="#val-tracef" class="anchor"></a><code><span><span class="keyword">val</span> tracef : 
  <span><span class="optlabel">?loc</span>:<a href="../../Range/index.html#type-t">Range.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">'a</span>, <span class="xref-unresolved">Stdlib</span>.Format.formatter, unit, <span><span>(<span>unit <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'b</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'b</span>)</span> <span class="xref-unresolved">Stdlib</span>.format4</span> <span class="arrow">&#45;&gt;</span></span>
  <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p><code>tracef format ... f</code> formats and records a frame in the backtrace, and runs the thunk <code>f</code> with the new backtrace. Note that there should not be any literal control characters. See <a href="../../Diagnostic/index.html#type-text"><code>Diagnostic.text</code></a>.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">loc</span> <p>The location of the text (usually the code) to highlight. Note that a location given here will become the new default location for inner <a href="#val-emit"><code>emit</code></a> and <a href="#val-fatal"><code>fatal</code></a>.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-trace_text"><a href="#val-trace_text" class="anchor"></a><code><span><span class="keyword">val</span> trace_text : <span><span class="optlabel">?loc</span>:<a href="../../Range/index.html#type-t">Range.t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../Diagnostic/index.html#type-text">Diagnostic.text</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span>unit <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p><code>trace_text text f</code> records the <code>text</code> and runs the thunk <code>f</code> with the new backtrace.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">loc</span> <p>The location of the text (usually the code) to highlight. Note that a location given here will become the new default location for inner <a href="#val-emit"><code>emit</code></a> and <a href="#val-fatal"><code>fatal</code></a>.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-trace_loctext"><a href="#val-trace_loctext" class="anchor"></a><code><span><span class="keyword">val</span> trace_loctext : <span><a href="../../Diagnostic/index.html#type-loctext">Diagnostic.loctext</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span>unit <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p><code>trace_loctext loctext f</code> records the <code>loctext</code> and runs the thunk <code>f</code> with the new backtrace. Note that a non-<code>None</code> location given here will become the new default location for inner <a href="#val-emit"><code>emit</code></a> and <a href="#val-fatal"><code>fatal</code></a>.</p></div></div><h3 id="locations"><a href="#locations" class="anchor"></a>Locations</h3><div class="odoc-spec"><div class="spec value anchored" id="val-get_loc"><a href="#val-get_loc" class="anchor"></a><code><span><span class="keyword">val</span> get_loc : <span>unit <span class="arrow">&#45;&gt;</span></span> <span><a href="../../Range/index.html#type-t">Range.t</a> option</span></span></code></div><div class="spec-doc"><p><code>get_loc()</code> returns the current default location for <a href="#val-emit"><code>emit</code></a> and <a href="#val-fatal"><code>fatal</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-with_loc"><a href="#val-with_loc" class="anchor"></a><code><span><span class="keyword">val</span> with_loc : <span><span><a href="../../Range/index.html#type-t">Range.t</a> option</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span>unit <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p><code>with_loc loc f</code> runs the thunk <code>f</code> with <code>loc</code> as the new default location for <a href="#val-emit"><code>emit</code></a> and <a href="#val-fatal"><code>fatal</code></a>. Note that <code>with_loc None</code> will clear the current default location, while <code>merge_loc None</code> will keep it. See <a href="#val-merge_loc"><code>merge_loc</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-merge_loc"><a href="#val-merge_loc" class="anchor"></a><code><span><span class="keyword">val</span> merge_loc : <span><span><a href="../../Range/index.html#type-t">Range.t</a> option</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span>unit <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p><code>merge_loc loc f</code> &quot;merges&quot; <code>loc</code> into the current default location for <a href="#val-emit"><code>emit</code></a> and <a href="#val-fatal"><code>fatal</code></a> and runs the thunk <code>f</code>. By &quot;merge&quot;, it means that if <code>loc</code> is <code>None</code>, then the current default location is kept; otherwise, it is overwritten. Note that <code>with_loc None</code> will clear the current default location, while <code>merge_loc None</code> will keep it. See <a href="#val-with_loc"><code>with_loc</code></a>.</p></div></div><h3 id="constructing-diagnostics"><a href="#constructing-diagnostics" class="anchor"></a>Constructing Diagnostics</h3><p>Functions in this section differ from the ones in <a href="../../Diagnostic/index.html"><code>Diagnostic</code></a> (for example, <a href="../../Diagnostic/index.html#val-make"><code>Diagnostic.make</code></a>) in that they fill out the current location, the current backtrace, and the severity automatically. (One can still overwrite them with optional arguments.)</p><div class="odoc-spec"><div class="spec value anchored" id="val-diagnostic"><a href="#val-diagnostic" class="anchor"></a><code><span><span class="keyword">val</span> diagnostic : 
  <span><span class="optlabel">?severity</span>:<a href="../../Diagnostic/index.html#type-severity">Diagnostic.severity</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?loc</span>:<a href="../../Range/index.html#type-t">Range.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?text</span>:<a href="../../Diagnostic/index.html#type-text">Diagnostic.text</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?backtrace</span>:<a href="../../Diagnostic/index.html#type-backtrace">Diagnostic.backtrace</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?extra_remarks</span>:<span><a href="../../Diagnostic/index.html#type-loctext">Diagnostic.loctext</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="Message/index.html#type-t">Message.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="Message/index.html#type-t">Message.t</a> <a href="../../Diagnostic/index.html#type-t">Diagnostic.t</a></span></span></code></div><div class="spec-doc"><p><code>diagnostic message</code> constructs a diagnostic with the <code>message</code> along with the backtrace frames recorded via <a href="#val-trace"><code>trace</code></a>.</p><p>Example:</p><pre class="language-ocaml"><code>Reporter.diagnostic @@ SyntaxError &quot;too many emojis&quot;</code></pre><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">severity</span> <p>The severity (to overwrite the default severity inferred from the <code>message</code>).</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">loc</span> <p>The location of the text (usually the code) to highlight. The default value is the innermost location given by <a href="#val-trace"><code>trace</code></a>, <a href="#val-with_loc"><code>with_loc</code></a>, <a href="#val-merge_loc"><code>merge_loc</code></a>, or <a href="#val-run"><code>run</code></a>.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">text</span> <p>The text (to overwrite the default text inferred from the <code>message</code>).</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">backtrace</span> <p>The backtrace (to overwrite the accumulative frames up to this point).</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">extra_remarks</span> <p>Additional remarks that are not part of the backtrace.</p></li></ul></div></div><h3 id="algebraic-effects"><a href="#algebraic-effects" class="anchor"></a>Algebraic Effects</h3><div class="odoc-spec"><div class="spec value anchored" id="val-run"><a href="#val-run" class="anchor"></a><code><span><span class="keyword">val</span> run : 
  <span><span class="optlabel">?init_loc</span>:<a href="../../Range/index.html#type-t">Range.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?init_backtrace</span>:<a href="../../Diagnostic/index.html#type-backtrace">Diagnostic.backtrace</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">emit</span>:<span>(<span><span><a href="Message/index.html#type-t">Message.t</a> <a href="../../Diagnostic/index.html#type-t">Diagnostic.t</a></span> <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">fatal</span>:<span>(<span><span><a href="Message/index.html#type-t">Message.t</a> <a href="../../Diagnostic/index.html#type-t">Diagnostic.t</a></span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span>unit <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p><code>run ~emit ~fatal f</code> runs the thunk <code>f</code>, using <code>emit</code> to handle non-fatal diagnostics before continuing the computation (see <a href="#val-emit"><code>emit</code></a>), and <code>fatal</code> to handle fatal diagnostics that have aborted the computation (see <a href="#val-fatal"><code>fatal</code></a>).</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">init_loc</span> <p>The initial default location for inner <a href="#val-emit"><code>emit</code></a> and <a href="#val-fatal"><code>fatal</code></a>.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">init_backtrace</span> <p>The initial backtrace to start with. The default value is the empty backtrace.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">emit</span> <p>The handler of non-fatal diagnostics.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">fatal</span> <p>The handler of fatal diagnostics.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-adopt"><a href="#val-adopt" class="anchor"></a><code><span><span class="keyword">val</span> adopt : 
  <span><span>(<span><span><span class="type-var">'message</span> <a href="../../Diagnostic/index.html#type-t">Diagnostic.t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><a href="Message/index.html#type-t">Message.t</a> <a href="../../Diagnostic/index.html#type-t">Diagnostic.t</a></span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span><span class="optlabel">?init_loc</span>:<a href="../../Range/index.html#type-t">Range.t</a> <span class="arrow">&#45;&gt;</span></span>
    <span><span class="optlabel">?init_backtrace</span>:<a href="../../Diagnostic/index.html#type-backtrace">Diagnostic.backtrace</a> <span class="arrow">&#45;&gt;</span></span>
    <span><span class="label">emit</span>:<span>(<span><span><span class="type-var">'message</span> <a href="../../Diagnostic/index.html#type-t">Diagnostic.t</a></span> <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span>
    <span><span class="label">fatal</span>:<span>(<span><span><span class="type-var">'message</span> <a href="../../Diagnostic/index.html#type-t">Diagnostic.t</a></span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>)</span> <span class="arrow">&#45;&gt;</span></span>
    <span><span>(<span>unit <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>)</span> <span class="arrow">&#45;&gt;</span></span>
    <span class="type-var">'a</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span>unit <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p><code>adopt m run f</code> runs the thunk <code>f</code> that uses a <i>different</i> <code>Reporter</code> instance. It takes the runner <code>run</code> from that <code>Reporter</code> instance as an argument to handle effects, and will use <code>m</code> to transform diagnostics generated by <code>f</code> into ones in the current <code>Reporter</code> instance. The backtrace within <code>f</code> will include the backtrace that leads to <code>adopt</code>, and the innermost specified location will be carried over, too. The intended use case is to integrate diagnostics from a library into those in the main application.</p><p><code>adopt</code> is a convenience function that can be implemented as follows:</p><pre class="language-ocaml"><code>let adopt m f run =
  run
    ?init_loc:(get_loc())
    ?init_backtrace:(Some (get_backtrace()))
    ~emit:(fun d -&gt; emit_diagnostic (m d))
    ~fatal:(fun d -&gt; fatal_diagnostic (m d))
    f</code></pre><p>Here shows the intended usage, where <code>Cool_lib</code> is the library to be used in the main application:</p><pre class="language-ocaml"><code>Reporter.adopt (Diagnostic.map message_mapper) Cool_lib.Reporter.run @@ fun () -&gt; ...</code></pre></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-try_with"><a href="#val-try_with" class="anchor"></a><code><span><span class="keyword">val</span> try_with : 
  <span><span class="optlabel">?emit</span>:<span>(<span><span><a href="Message/index.html#type-t">Message.t</a> <a href="../../Diagnostic/index.html#type-t">Diagnostic.t</a></span> <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?fatal</span>:<span>(<span><span><a href="Message/index.html#type-t">Message.t</a> <a href="../../Diagnostic/index.html#type-t">Diagnostic.t</a></span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span>unit <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p><code>try_with ~emit ~fatal f</code> runs the thunk <code>f</code>, using <code>emit</code> to intercept non-fatal diagnostics before continuing the computation (see <a href="#val-emit"><code>emit</code></a>), and <code>fatal</code> to intercept fatal diagnostics that have aborted the computation (see <a href="#val-fatal"><code>fatal</code></a>). The default interceptors re-emit or re-raise the intercepted diagnostics.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">emit</span> <p>The interceptor of non-fatal diagnostics. The default value is <a href="#val-emit_diagnostic"><code>emit_diagnostic</code></a>.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">fatal</span> <p>The interceptor of fatal diagnostics. The default value is <a href="#val-fatal_diagnostic"><code>fatal_diagnostic</code></a>.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-map_diagnostic"><a href="#val-map_diagnostic" class="anchor"></a><code><span><span class="keyword">val</span> map_diagnostic : 
  <span><span>(<span><span><a href="Message/index.html#type-t">Message.t</a> <a href="../../Diagnostic/index.html#type-t">Diagnostic.t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><a href="Message/index.html#type-t">Message.t</a> <a href="../../Diagnostic/index.html#type-t">Diagnostic.t</a></span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span>unit <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p><code>map_diagnostic m f</code> runs the thunk <code>f</code> and applies <code>m</code> to any diagnostic sent by <code>f</code>. It is a convenience function that can be implemented as follows:</p><pre class="language-ocaml"><code>let map_diagnostic m f =
  try_with
    ~fatal:(fun d -&gt; fatal_diagnostic (m d))
    ~emit:(fun d -&gt; emit_diagnostic (m d))
    f</code></pre><ul class="at-tags"><li class="since"><span class="at-tag">since</span> 0.2.0</li></ul></div></div><h3 id="debugging"><a href="#debugging" class="anchor"></a>Debugging</h3><div class="odoc-spec"><div class="spec value anchored" id="val-register_printer"><a href="#val-register_printer" class="anchor"></a><code><span><span class="keyword">val</span> register_printer : 
  <span><span>(<span><span>[ `Trace
   <span><span>| `Emit</span> of <span><a href="Message/index.html#type-t">Message.t</a> <a href="../../Diagnostic/index.html#type-t">Diagnostic.t</a></span></span>
   <span><span>| `Fatal</span> of <span><a href="Message/index.html#type-t">Message.t</a> <a href="../../Diagnostic/index.html#type-t">Diagnostic.t</a></span></span> ]</span> <span class="arrow">&#45;&gt;</span></span>
    <span>string option</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div><div class="spec-doc"><p><code>register_printer p</code> registers a printer <code>p</code> via <code>Printexc.register_printer</code> to convert unhandled internal effects and exceptions into strings for the OCaml runtime system to display. Ideally, all internal effects and exceptions should have been handled by <a href="#val-run"><code>run</code></a> and there is no need to use this function, but when it is not the case, this function can be helpful for debugging. The functor <a href="../../Reporter/Make/index.html"><code>Reporter.Make</code></a> always registers a simple printer to suggest using <a href="#val-run"><code>run</code></a>, but you can register new ones to override it. The return type of the printer <code>p</code> should return <code>Some s</code> where <code>s</code> is the resulting string, or <code>None</code> if it chooses not to convert a particular effect or exception. The registered printers are tried in reverse order until one of them returns <code>Some s</code> for some <code>s</code>; that is, the last registered printer is tried first. Note that this function is a wrapper of <code>Printexc.register_printer</code> and all the registered printers (via this function or <code>Printexc.register_printer</code>) are put into the same list.</p><p>The input type of the printer <code>p</code> is a variant representation of all internal effects and exceptions used in this module:</p><ul><li><code>`Trace</code> corresponds to the effect triggered by <a href="#val-trace"><code>trace</code></a>; and</li><li><code>`Emit diag</code> corresponds to the effect triggered by <a href="#val-emit"><code>emit</code></a>; and</li><li><code>`Fatal diag</code> corresponds to the exception triggered by <a href="#val-fatal"><code>fatal</code></a>.</li></ul><p>Note: <a href="../../Diagnostic/index.html#val-string_of_text"><code>Diagnostic.string_of_text</code></a> can be handy for converting a text into a string.</p></div></div></div></body></html>
