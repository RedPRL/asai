<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Diagnostic (asai.Asai.Diagnostic)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">asai</a> &#x00BB; <a href="../index.html">Asai</a> &#x00BB; Diagnostic</nav><header class="odoc-preamble"><h1>Module <code><span>Asai.Diagnostic</span></code></h1><p>The definition of diagnostics and some utility functions.</p></header><nav class="odoc-toc"><ul><li><a href="#types">Types</a></li><li><a href="#constructing-messages">Constructing Messages</a></li><li><a href="#constructing-diagnostics">Constructing Diagnostics</a></li><li><a href="#other-helper-functions">Other Helper Functions</a></li></ul></nav><div class="odoc-content"><h2 id="types"><a href="#types" class="anchor"></a>Types</h2><div class="odoc-spec"><div class="spec type anchored" id="type-severity"><a href="#type-severity" class="anchor"></a><code><span><span class="keyword">type</span> severity</span><span> = </span></code><ol><li id="type-severity.Hint" class="def variant constructor anchored"><a href="#type-severity.Hint" class="anchor"></a><code><span>| </span><span><span class="constructor">Hint</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>This corresponds to the <code>Hint</code> severity level from LSP (Language Server Protocol). The official specification did not give much guidance on the difference between this level and <a href="#type-severity.Info"><code>Info</code></a>. However, <a href="https://github.com/microsoft/language-server-protocol/issues/325#issuecomment-344570720">according to the LSP developers, &quot;the idea of the hint severity&quot; is that &quot;for example we in VS Code don't render in the UI as squiggles.&quot;</a> They are often used to indicate code smell, along with edit suggestions to fix it.</p><span class="comment-delim">*)</span></div></li><li id="type-severity.Info" class="def variant constructor anchored"><a href="#type-severity.Info" class="anchor"></a><code><span>| </span><span><span class="constructor">Info</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>This corresponds to the <code>Information</code> severity level from LSP (Language Server Protocol). The official specification did not give much guidance on the difference between this level and <a href="#type-severity.Hint"><code>Hint</code></a>.</p><span class="comment-delim">*)</span></div></li><li id="type-severity.Warning" class="def variant constructor anchored"><a href="#type-severity.Warning" class="anchor"></a><code><span>| </span><span><span class="constructor">Warning</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Something went wrong or looked suspicious, but the end user (the user of your proof assistant or compiler) may choose to ignore the issue. For example, maybe some named arguments were not used in a definition.</p><span class="comment-delim">*)</span></div></li><li id="type-severity.Error" class="def variant constructor anchored"><a href="#type-severity.Error" class="anchor"></a><code><span>| </span><span><span class="constructor">Error</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>A serious error caused by the end user (the user of your proof assistant or compiler) or other external factors (e.g., internet not working).</p><span class="comment-delim">*)</span></div></li><li id="type-severity.Bug" class="def variant constructor anchored"><a href="#type-severity.Bug" class="anchor"></a><code><span>| </span><span><span class="constructor">Bug</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>A serious error likely caused by a bug in the proof assistant. You would want the end user to report the bug back to you. This is useful for indicating that certain branches in a pattern matching should be &quot;impossible&quot;, while printing out debugging information in case the program logic is flawed.</p><span class="comment-delim">*)</span></div></li></ol></div><div class="spec-doc"><p>The type of severity.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-text"><a href="#type-text" class="anchor"></a><code><span><span class="keyword">type</span> text</span><span> = <span><span class="xref-unresolved">Stdlib</span>.Format.formatter <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>The type of texts.</p><p>When we render a diagnostic, the layout engine of the diagnostic handler should be the one making layout choices. Therefore, we cannot pass already formatted strings. Instead, a text is defined to be a function that takes a formatter and uses it to render the content. A valid text must satisfy the following two conditions:</p><ol><li><b>All string (and character) literals must be encoded using UTF-8.</b></li><li><b>All string (and character) literals must not contain control characters (such as the newline character <code>\n</code>).</b> It is okay to have break hints (such as <code>@,</code> and <code>@ </code>) but not literal control characters. This means you should avoid pre-formatted strings, and if you must use them, use <a href="#val-text"><code>text</code></a> to convert newline characters. Control characters include `U+0000-001F` (C0 controls), `U+007F` (backspace) and `U+0080-009F` (C1 controls). These characters are banned because they would mess up the cursor position.</li></ol><p><i>Pro-tip:</i> to format a text in another text, use <code>%t</code>:</p><pre class="language-ocaml"><code>let t = textf &quot;@[&lt;2&gt;this is what the master said:@ @[%t@]@]&quot; inner_text</code></pre></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-loctext"><a href="#type-loctext" class="anchor"></a><code><span><span class="keyword">type</span> loctext</span><span> = <span><a href="#type-text">text</a> <a href="../Range/index.html#type-located">Range.located</a></span></span></code></div><div class="spec-doc"><p>A loctext is a <a href="#type-text"><code>text</code></a> with location information. &quot;loctext&quot; is a portmanteau of &quot;locate&quot; and &quot;text&quot;.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-backtrace"><a href="#type-backtrace" class="anchor"></a><code><span><span class="keyword">type</span> backtrace</span><span> = <span><a href="#type-loctext">loctext</a> <span class="xref-unresolved">Bwd</span>.bwd</span></span></code></div><div class="spec-doc"><p>A backtrace is a (backward) list of loctexts.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> <span>'message t</span></span><span> = </span><span>{</span></code><ol><li id="type-t.severity" class="def record field anchored"><a href="#type-t.severity" class="anchor"></a><code><span>severity : <a href="#type-severity">severity</a>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Severity of the diagnostic.</p><span class="comment-delim">*)</span></div></li><li id="type-t.message" class="def record field anchored"><a href="#type-t.message" class="anchor"></a><code><span>message : <span class="type-var">'message</span>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>The (structured) message.</p><span class="comment-delim">*)</span></div></li><li id="type-t.explanation" class="def record field anchored"><a href="#type-t.explanation" class="anchor"></a><code><span>explanation : <a href="#type-loctext">loctext</a>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>The free-form explanation.</p><span class="comment-delim">*)</span></div></li><li id="type-t.backtrace" class="def record field anchored"><a href="#type-t.backtrace" class="anchor"></a><code><span>backtrace : <a href="#type-backtrace">backtrace</a>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>The backtrace leading to this diagnostic.</p><span class="comment-delim">*)</span></div></li><li id="type-t.extra_remarks" class="def record field anchored"><a href="#type-t.extra_remarks" class="anchor"></a><code><span>extra_remarks : <span><a href="#type-loctext">loctext</a> <span class="xref-unresolved">Bwd</span>.bwd</span>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Additional remarks that are relevant to the main message but not part of the backtrace. It is a backward list so that new remarks can be added to its end easily.</p><span class="comment-delim">*)</span></div></li></ol><code><span>}</span></code></div><div class="spec-doc"><p>The type of diagnostics.</p></div></div><h2 id="constructing-messages"><a href="#constructing-messages" class="anchor"></a>Constructing Messages</h2><div class="odoc-spec"><div class="spec value anchored" id="val-text"><a href="#val-text" class="anchor"></a><code><span><span class="keyword">val</span> text : <span>string <span class="arrow">&#45;&gt;</span></span> <a href="#type-text">text</a></span></code></div><div class="spec-doc"><p><code>text str</code> converts the string <code>str</code> into a text, converting each <code>'\n'</code> into a call to <code>Format.pp_force_newline</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-textf"><a href="#val-textf" class="anchor"></a><code><span><span class="keyword">val</span> textf : <span><span><span>(<span class="type-var">'a</span>, <span class="xref-unresolved">Stdlib</span>.Format.formatter, unit, <a href="#type-text">text</a>)</span> <span class="xref-unresolved">Stdlib</span>.format4</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p><code>textf format ...</code> formats a text. It is an alias of <code>Format.dprintf</code>. Note that there should not be any literal control characters (e.g., literal newline characters).</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-ktextf"><a href="#val-ktextf" class="anchor"></a><code><span><span class="keyword">val</span> ktextf : 
  <span><span>(<span><a href="#type-text">text</a> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'b</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">'a</span>, <span class="xref-unresolved">Stdlib</span>.Format.formatter, unit, <span class="type-var">'b</span>)</span> <span class="xref-unresolved">Stdlib</span>.format4</span> <span class="arrow">&#45;&gt;</span></span>
  <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p><code>ktextf kont format ...</code> is <code>kont (textf format ...)</code>. It is an alias of <code>Format.kdprintf</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-loctext"><a href="#val-loctext" class="anchor"></a><code><span><span class="keyword">val</span> loctext : <span><span class="optlabel">?loc</span>:<a href="../Range/index.html#type-t">Range.t</a> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> <a href="#type-loctext">loctext</a></span></code></div><div class="spec-doc"><p><code>loctext str</code> converts the string <code>str</code> into a loctext.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">loc</span> <p>The location of the loctext (usually the code) to highlight.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-loctextf"><a href="#val-loctextf" class="anchor"></a><code><span><span class="keyword">val</span> loctextf : 
  <span><span class="optlabel">?loc</span>:<a href="../Range/index.html#type-t">Range.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">'a</span>, <span class="xref-unresolved">Stdlib</span>.Format.formatter, unit, <a href="#type-loctext">loctext</a>)</span> <span class="xref-unresolved">Stdlib</span>.format4</span> <span class="arrow">&#45;&gt;</span></span>
  <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p><code>loctextf format ...</code> constructs a loctext. Note that there should not be any literal control characters (e.g., literal newline characters).</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">loc</span> <p>The location of the loctext (usually the code) to highlight.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-kloctextf"><a href="#val-kloctextf" class="anchor"></a><code><span><span class="keyword">val</span> kloctextf : 
  <span><span class="optlabel">?loc</span>:<a href="../Range/index.html#type-t">Range.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span><a href="#type-loctext">loctext</a> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'b</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">'a</span>, <span class="xref-unresolved">Stdlib</span>.Format.formatter, unit, <span class="type-var">'b</span>)</span> <span class="xref-unresolved">Stdlib</span>.format4</span> <span class="arrow">&#45;&gt;</span></span>
  <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p><code>kloctextf kont format ...</code> is <code>kont (loctextf format ...)</code>.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">loc</span> <p>The location of the loctext (usually the code) to highlight.</p></li></ul></div></div><h2 id="constructing-diagnostics"><a href="#constructing-diagnostics" class="anchor"></a>Constructing Diagnostics</h2><div class="odoc-spec"><div class="spec value anchored" id="val-of_text"><a href="#val-of_text" class="anchor"></a><code><span><span class="keyword">val</span> of_text : 
  <span><span class="optlabel">?loc</span>:<a href="../Range/index.html#type-t">Range.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?backtrace</span>:<a href="#type-backtrace">backtrace</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?extra_remarks</span>:<span><a href="#type-loctext">loctext</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-severity">severity</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'message</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-text">text</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'message</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>of_text severity message text</code> constructs a diagnostic from a <a href="#type-text"><code>text</code></a>.</p><p>Example:</p><pre class="language-ocaml"><code>of_text Warning ChiError @@ text &quot;your Ch'i is critically low&quot;</code></pre><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">backtrace</span> <p>The backtrace (to overwrite the accumulative frames up to this point).</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">extra_remarks</span> <p>Additional remarks that are not part of the backtrace.</p></li></ul><ul class="at-tags"><li class="since"><span class="at-tag">since</span> 0.2.0</li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-of_loctext"><a href="#val-of_loctext" class="anchor"></a><code><span><span class="keyword">val</span> of_loctext : 
  <span><span class="optlabel">?backtrace</span>:<a href="#type-backtrace">backtrace</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?extra_remarks</span>:<span><a href="#type-loctext">loctext</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-severity">severity</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'message</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-loctext">loctext</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'message</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>of_loctext severity message loctext</code> constructs a diagnostic from a <a href="#type-loctext"><code>loctext</code></a>.</p><p>Example:</p><pre class="language-ocaml"><code>of_loctext Warning ChiError @@ loctext &quot;your Ch'i is critically low&quot;</code></pre><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">backtrace</span> <p>The backtrace (to overwrite the accumulative frames up to this point).</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">extra_remarks</span> <p>Additional remarks that are not part of the backtrace.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-make"><a href="#val-make" class="anchor"></a><code><span><span class="keyword">val</span> make : 
  <span><span class="optlabel">?loc</span>:<a href="../Range/index.html#type-t">Range.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?backtrace</span>:<a href="#type-backtrace">backtrace</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?extra_remarks</span>:<span><a href="#type-loctext">loctext</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-severity">severity</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'message</span> <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'message</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>make severity message loctext</code> constructs a diagnostic with the <code>loctext</code>.</p><p>Example:</p><pre class="language-ocaml"><code>make Warning ChiError &quot;your Ch'i is critically low&quot;</code></pre><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">backtrace</span> <p>The backtrace (to overwrite the accumulative frames up to this point).</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">extra_remarks</span> <p>Additional remarks that are not part of the backtrace.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-makef"><a href="#val-makef" class="anchor"></a><code><span><span class="keyword">val</span> makef : 
  <span><span class="optlabel">?loc</span>:<a href="../Range/index.html#type-t">Range.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?backtrace</span>:<a href="#type-backtrace">backtrace</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?extra_remarks</span>:<span><a href="#type-loctext">loctext</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-severity">severity</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'message</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">'a</span>, <span class="xref-unresolved">Stdlib</span>.Format.formatter, unit, <span><span class="type-var">'message</span> <a href="#type-t">t</a></span>)</span> <span class="xref-unresolved">Stdlib</span>.format4</span> <span class="arrow">&#45;&gt;</span></span>
  <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p><code>makef severity message format ...</code> is <code>of_loctext severity message (loctextf format ...)</code>. It formats the message and constructs a diagnostic out of it.</p><p>Example:</p><pre class="language-ocaml"><code>makef Warning ChiError &quot;your %s is critically low&quot; &quot;Ch'i&quot;</code></pre><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">loc</span> <p>The location of the text (usually the code) to highlight.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">backtrace</span> <p>The backtrace (to overwrite the accumulative frames up to this point).</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">extra_remarks</span> <p>Additional remarks that are not part of the backtrace.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-kmakef"><a href="#val-kmakef" class="anchor"></a><code><span><span class="keyword">val</span> kmakef : 
  <span><span class="optlabel">?loc</span>:<a href="../Range/index.html#type-t">Range.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?backtrace</span>:<a href="#type-backtrace">backtrace</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?extra_remarks</span>:<span><a href="#type-loctext">loctext</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span><span><span class="type-var">'message</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'b</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-severity">severity</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'message</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">'a</span>, <span class="xref-unresolved">Stdlib</span>.Format.formatter, unit, <span class="type-var">'b</span>)</span> <span class="xref-unresolved">Stdlib</span>.format4</span> <span class="arrow">&#45;&gt;</span></span>
  <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p><code>kmakef kont severity message format ...</code> is <code>kont (makef severity message format ...)</code>.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">loc</span> <p>The location of the text (usually the code) to highlight.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">backtrace</span> <p>The backtrace (to overwrite the accumulative frames up to this point).</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">extra_remarks</span> <p>Additional remarks that are not part of the backtrace.</p></li></ul></div></div><h2 id="other-helper-functions"><a href="#other-helper-functions" class="anchor"></a>Other Helper Functions</h2><div class="odoc-spec"><div class="spec value anchored" id="val-map"><a href="#val-map" class="anchor"></a><code><span><span class="keyword">val</span> map : <span><span>(<span><span class="type-var">'message1</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'message2</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'message1</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'message2</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>A convenience function that maps the message of a diagnostic. This is helpful when using <a href="../Reporter/module-type-S/index.html#val-adopt"><code>Reporter.S.adopt</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-string_of_text"><a href="#val-string_of_text" class="anchor"></a><code><span><span class="keyword">val</span> string_of_text : <span><a href="#type-text">text</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>A convenience function that converts a <a href="#type-text"><code>text</code></a> into a string by formatting it with the maximum admissible margin and then replacing newlines and indentation with a space character.</p></div></div></div></body></html>
